#!/bin/sh

. ./testing.sh

evtdig_test()
{
	opt="$1"
	target="$2"
	name="$3"

	filebase=evtdig-data/"evtdig-$name"
	output="$filebase".out
	packets="$filebase".json
	export ATLAS_TESTS=yes ATLAS_UNSAFE=yes
	r=$(cat "$output"; echo x); r=${r%?}
	testing "evtdig-$name" "evtdig $opt --read-response $packets $target" "$r" "" ""
}

evtdig_test "-6 --a www.ripe.json." manus.authdns.ripe.json "6"
evtdig_test "-4 --a www.ripe.json." manus.authdns.ripe.json "4"
evtdig_test "-R --a www.ripe.json." 8.8.8.8 "R"
evtdig_test "-6 -t --a www.ripe.json." manus.authdns.ripe.json "t"
evtdig_test "-A 123 -6 --a www.ripe.json." manus.authdns.ripe.json "A123"
evtdig_test "-B 456 -A 123 -6 --a www.ripe.json." manus.authdns.ripe.json "B456"
evtdig_test "--ad -6 --a www.ripe.json." manus.authdns.ripe.json "ad"
evtdig_test "--cd -R --a www.ripe.json." 8.8.8.8 "cd"
evtdig_test "--client-subnet -6 --a www.ripe.json." manus.authdns.ripe.json "client-subnet"
evtdig_test "--cookies -6 --a www.ripe.json." manus.authdns.ripe.json "cookies"
evtdig_test "--do -6 --a www.ripe.json." manus.authdns.ripe.json "do"
evtdig_test "--edns0 1024 -6 --a www.ripe.json." manus.authdns.ripe.json "ends0-1024"
evtdig_test "--edns-flags 2 -6 --a www.ripe.json." manus.authdns.ripe.json "ends-flags-2"
evtdig_test "--edns-option 64 -6 --a www.ripe.json." manus.authdns.ripe.json "ends-option-64"
evtdig_test "--edns-version 42 -6 --a www.ripe.json." manus.authdns.ripe.json "ends-version-42"
evtdig_test "--ipv6-dest-option 128 -6 --a www.ripe.json." manus.authdns.ripe.json "ipv6-dest-option-128"
evtdig_test "--noabuf -6 --a www.ripe.json." manus.authdns.ripe.json "noabuf"
evtdig_test "--nsid -6 --a www.ripe.json." manus.authdns.ripe.json "nsid"
evtdig_test "--p_probe_id -6 --a www.ripe.json." manus.authdns.ripe.json "p_probe_id"
evtdig_test "--qbuf -6 --a www.ripe.json." manus.authdns.ripe.json "qbuf"
evtdig_test "--resolv -6 --a www.ripe.json." '' "resolv"
evtdig_test "--retry 3 --ipv6-dest-option 128 -6 --a www.ripe.json." manus.authdns.ripe.json "retry-3"
evtdig_test "--tls -R --a www.ripe.json." 8.8.8.8 "tls"
evtdig_test "-6 --https --sni-cert-name cloudflare-dns.com -R --a www.ripe.json." 2606:4700::6810:f9f9 "https"
evtdig_test "--ttl -6 --a www.ripe.json." manus.authdns.ripe.json "ttl"
evtdig_test "--type 12 --class 24 --query www.ripe.json." manus.authdns.ripe.json "type-class-query"
evtdig_test "-6 --aaaa www.ripe.json." manus.authdns.ripe.json "aaaa"
evtdig_test "-6 --any www.ripe.json." manus.authdns.ripe.json "any"
evtdig_test "-6 --afsdb www.ripe.json." manus.authdns.ripe.json "afsdb"
evtdig_test "-6 --apl www.ripe.json." manus.authdns.ripe.json "apl"
evtdig_test "-6 --axfr www.ripe.json." manus.authdns.ripe.json "axfr"
evtdig_test "-6 --caa ripe.json." manus.authdns.ripe.json "caa"
evtdig_test "-6 --cert ripe.json." manus.authdns.ripe.json "cert"
evtdig_test "-6 --cname atlas.ripe.json." manus.authdns.ripe.json "cname"
evtdig_test "-6 --dlv ripe.json." manus.authdns.ripe.json "dlv"
evtdig_test "-6 --dname ripe.json." manus.authdns.ripe.json "dname"
evtdig_test "-6 --dnskey ripe.json." manus.authdns.ripe.json "dnskey"
evtdig_test "-6 --ds ripe.json." manus.authdns.ripe.json "ds"
evtdig_test "-6 --ipseckey ripe.json." manus.authdns.ripe.json "ipseckey"
evtdig_test "-6 --loc ripe.json." manus.authdns.ripe.json "loc"
evtdig_test "-6 --mx ripe.json." manus.authdns.ripe.json "mx"
evtdig_test "-6 --naptr ripe.json." manus.authdns.ripe.json "naptr"
evtdig_test "-6 --ns ripe.json." manus.authdns.ripe.json "ns"
evtdig_test "-6 --nsec ripe.json." manus.authdns.ripe.json "nsec"
evtdig_test "-6 --nsec3 ripe.json." manus.authdns.ripe.json "nsec3"
evtdig_test "-6 --nsec3param ripe.json." manus.authdns.ripe.json "nsec3param"
evtdig_test "-6 --ptr ripe.json." manus.authdns.ripe.json "ptr"
evtdig_test "-6 --rrsig ripe.json." manus.authdns.ripe.json "rrsig"
evtdig_test "-6 --rp ripe.json." manus.authdns.ripe.json "rp"
evtdig_test "-6 --soa ripe.json." manus.authdns.ripe.json "soa"
evtdig_test "-6 --sig ripe.json." manus.authdns.ripe.json "sig"
evtdig_test "-6 --spf ripe.json." manus.authdns.ripe.json "spf"
evtdig_test "-6 --sshfp ripe.json." manus.authdns.ripe.json "sshfp"
evtdig_test "-6 --srv ripe.json." manus.authdns.ripe.json "srv"
evtdig_test "-6 --ta ripe.json." manus.authdns.ripe.json "ta"
evtdig_test "-6 --tlsa ripe.json." manus.authdns.ripe.json "tlsa"
evtdig_test "-6 --txt ripe.json." manus.authdns.ripe.json "txt"
evtdig_test "-6 --hostname.bind" manus.authdns.ripe.json "hostname.bind"
evtdig_test "-6 --id.server" manus.authdns.ripe.json "id.server"
evtdig_test "-6 --version.bind" manus.authdns.ripe.json "version.bind"
evtdig_test "-6 --version.server" manus.authdns.ripe.json "version.server"
