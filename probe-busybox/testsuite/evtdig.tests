#!/bin/sh

. ./testing.sh

evtdig_test()
{
	opt="$1"
	target="$2"
	name="$3"

	filebase=evtdig-data/"evtdig-$name"
	output="$filebase".out
	packets="$filebase".net
	export ATLAS_TESTS=yes ATLAS_UNSAFE=yes
	r=$(cat "$output"; echo x); r=${r%?}
	testing "evtdig-$name" "evtdig $opt --read-response $packets $target" "$r" "" ""
}

evtdig_test "-6 --a www.ripe.net." manus.authdns.ripe.net "6"
evtdig_test "-4 --a www.ripe.net." manus.authdns.ripe.net "4"
evtdig_test "-R --a www.ripe.net." 8.8.8.8 "R"
evtdig_test "-6 -t --a www.ripe.net." manus.authdns.ripe.net "t"
evtdig_test "-A 123 -6 --a www.ripe.net." manus.authdns.ripe.net "A123"
evtdig_test "-B 456 -A 123 -6 --a www.ripe.net." manus.authdns.ripe.net "B456"
evtdig_test "--ad -6 --a www.ripe.net." manus.authdns.ripe.net "ad"
evtdig_test "--cd -R --a www.ripe.net." 8.8.8.8 "cd"
evtdig_test "--client-subnet -6 --a www.ripe.net." manus.authdns.ripe.net "client-subnet"
evtdig_test "--cookies -6 --a www.ripe.net." manus.authdns.ripe.net "cookies"
evtdig_test "--do -6 --a www.ripe.net." manus.authdns.ripe.net "do"
evtdig_test "--edns0 1024 -6 --a www.ripe.net." manus.authdns.ripe.net "ends0-1024"
evtdig_test "--edns-flags 2 -6 --a www.ripe.net." manus.authdns.ripe.net "ends-flags-2"
evtdig_test "--edns-option 64 -6 --a www.ripe.net." manus.authdns.ripe.net "ends-option-64"
evtdig_test "--edns-version 42 -6 --a www.ripe.net." manus.authdns.ripe.net "ends-version-42"
evtdig_test "--ipv6-dest-option 128 -6 --a www.ripe.net." manus.authdns.ripe.net "ipv6-dest-option-128"
evtdig_test "--noabuf -6 --a www.ripe.net." manus.authdns.ripe.net "noabuf"
evtdig_test "--nsid -6 --a www.ripe.net." manus.authdns.ripe.net "nsid"
evtdig_test "--p_probe_id -6 --a www.ripe.net." manus.authdns.ripe.net "p_probe_id"
evtdig_test "--qbuf -6 --a www.ripe.net." manus.authdns.ripe.net "qbuf"
evtdig_test "--resolv -6 --a www.ripe.net." '' "resolv"
evtdig_test "--retry 3 --ipv6-dest-option 128 -6 --a www.ripe.net." manus.authdns.ripe.net "retry-3"
evtdig_test "--tls -R --a www.ripe.net." 8.8.8.8 "tls"
evtdig_test "-6 --https --sni-cert-name cloudflare-dns.com -R --a www.ripe.net." 2606:4700::6810:f9f9 "https"
evtdig_test "--ttl -6 --a www.ripe.net." manus.authdns.ripe.net "ttl"
evtdig_test "--type 12 --class 24 --query www.ripe.net." manus.authdns.ripe.net "type-class-query"
evtdig_test "-6 --aaaa www.ripe.net." manus.authdns.ripe.net "aaaa"
evtdig_test "-6 --any www.ripe.net." manus.authdns.ripe.net "any"
evtdig_test "-6 --afsdb www.ripe.net." manus.authdns.ripe.net "afsdb"
evtdig_test "-6 --apl www.ripe.net." manus.authdns.ripe.net "apl"
evtdig_test "-6 --axfr www.ripe.net." manus.authdns.ripe.net "axfr"
evtdig_test "-6 --caa ripe.net." manus.authdns.ripe.net "caa"
evtdig_test "-6 --cert ripe.net." manus.authdns.ripe.net "cert"
evtdig_test "-6 --cname atlas.ripe.net." manus.authdns.ripe.net "cname"
evtdig_test "-6 --dlv ripe.net." manus.authdns.ripe.net "dlv"
evtdig_test "-6 --dname ripe.net." manus.authdns.ripe.net "dname"
evtdig_test "-6 --dnskey ripe.net." manus.authdns.ripe.net "dnskey"
evtdig_test "-6 --ds ripe.net." manus.authdns.ripe.net "ds"
evtdig_test "-6 --ipseckey ripe.net." manus.authdns.ripe.net "ipseckey"
evtdig_test "-6 --loc ripe.net." manus.authdns.ripe.net "loc"
evtdig_test "-6 --mx ripe.net." manus.authdns.ripe.net "mx"
evtdig_test "-6 --naptr ripe.net." manus.authdns.ripe.net "naptr"
evtdig_test "-6 --ns ripe.net." manus.authdns.ripe.net "ns"
evtdig_test "-6 --nsec ripe.net." manus.authdns.ripe.net "nsec"
evtdig_test "-6 --nsec3 ripe.net." manus.authdns.ripe.net "nsec3"
evtdig_test "-6 --nsec3param ripe.net." manus.authdns.ripe.net "nsec3param"
evtdig_test "-6 --ptr ripe.net." manus.authdns.ripe.net "ptr"
evtdig_test "-6 --rrsig ripe.net." manus.authdns.ripe.net "rrsig"
evtdig_test "-6 --rp ripe.net." manus.authdns.ripe.net "rp"
evtdig_test "-6 --soa ripe.net." manus.authdns.ripe.net "soa"
evtdig_test "-6 --sig ripe.net." manus.authdns.ripe.net "sig"
evtdig_test "-6 --spf ripe.net." manus.authdns.ripe.net "spf"
evtdig_test "-6 --sshfp ripe.net." manus.authdns.ripe.net "sshfp"
evtdig_test "-6 --srv ripe.net." manus.authdns.ripe.net "srv"
evtdig_test "-6 --ta ripe.net." manus.authdns.ripe.net "ta"
evtdig_test "-6 --tlsa ripe.net." manus.authdns.ripe.net "tlsa"
evtdig_test "-6 --txt ripe.net." manus.authdns.ripe.net "txt"
evtdig_test "-6 --hostname.bind" manus.authdns.ripe.net "hostname.bind"
evtdig_test "-6 --id.server" manus.authdns.ripe.net "id.server"
evtdig_test "-6 --version.bind" manus.authdns.ripe.net "version.bind"
evtdig_test "-6 --version.server" manus.authdns.ripe.net "version.server"
